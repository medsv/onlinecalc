import streamlit as st
from libs.wsprops.region1 import Region1
from common.print_result import print_result

st.set_page_config(
    page_title="–†–∞—Å—á—ë—Ç –∫–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞",
    page_icon="üíª",
    layout="centered"
)

st.title("–†–∞—Å—á—ë—Ç –∫–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞")
st.markdown("–î–æ–ø—É—Å–∫–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–µ–ª–∏—á–∏–Ω: t = [0; 350] ¬∞–°,  p = [611,213 –ü–∞; 100 –ú–ü–∞]")
st.markdown("–†–∞–±–æ—á–∞—è –∂–∏–¥–∫–æ—Å—Ç—å - –≤–æ–¥–∞.")
with st.expander("–°—Ö–µ–º–∞"):
    st.image("img/–ö–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π_–∑–∞–ø–∞—Å_–°—Ö–µ–º–∞.png")
    st.markdown("p - –¥–∞–≤–ª–µ–Ω–∏–µ (–∞–±—Å–æ–ª—é—Ç–Ω–æ–µ) –Ω–∞–¥ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å—é –≤–æ–¥—ã, –ü–∞;\n\nt - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã, ¬∞–°;\n\n" \
    "H - –ø–æ–¥–ø–æ—Ä, —Ä–∞–∑–Ω–∏—Ü–∞ –æ—Ç–º–µ—Ç–æ–∫ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –≤–æ–¥—ã –∏ –æ—Å–∏ –≤–∞–ª–∞ –Ω–∞—Å–æ—Å–∞ (–º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è), –º;\n\n" \
        "dH - –ø–æ—Ç–µ—Ä–∏ –¥–∞–≤–ª–µ–Ω–∏—è (–Ω–∞–ø–æ—Ä–∞) –≤ –ø–æ–¥–≤–æ–¥—è—â–µ–º —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥–µ, –º.")

p: float = st.number_input("–ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ, –ü–∞", value=101325.0, step=1., min_value=611.213, max_value=100e6, key ="p", width = 200)
t: float = st.number_input("–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, ¬∞–°", value=20., step=1., min_value=0., max_value= 623.15-273.15, key ="t", width = 200)
H: float = st.number_input("–ü–æ–¥–ø–æ—Ä, –º", value=0., step=1., min_value=-1000., max_value=1000., key ="H", width = 200)
dH: float = st.number_input("–ü–æ—Ç–µ—Ä–∏ –¥–∞–≤–ª–µ–Ω–∏—è (–Ω–∞–ø–æ—Ä–∞), –º", value=0., step=1., min_value=0., max_value=1000., key ="dH", width = 200)
water = Region1()
if st.button("–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"):
    if not water.Tp_in(t + 273.15, p):
        t_cor = water.sc.t_p(p)
        p_cor = water.sc.p_t(t)
        mes = f"–°–æ—á–µ—Ç–∞–Ω–∏–µ –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –¥–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–∞—Ä—É. –î–ª—è –≤–æ–¥—ã –ª–∏–±–æ –¥–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—ã—à–µ {p_cor} –ü–∞, –ª–∏–±–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∏–∂–µ {t_cor} ¬∞–°."
        st.error(mes, icon="‚ö†Ô∏è")
    else:
        try:
            props = water.props_tp(t,p)
            ps: float = water.sc.p_t(t)
            NPSH: float = H + (p - ps) * props["v"] / 9.81 - dH
            #data={"–ö–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ø–∞—Å (NPSH), –º": NPSH}
            data = {"–î–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–¥ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å—é –≤–æ–¥—ã, –ü–∞": p, "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–æ–¥—ã, ¬∞–°": t, "–ü–æ–¥–ø–æ—Ä, –º": H, 
                    "–ü–æ—Ç–µ—Ä–∏ –¥–∞–≤–ª–µ–Ω–∏—è (–Ω–∞–ø–æ—Ä–∞), –º": dH, "–î–∞–≤–ª–µ–Ω–∏–µ –∫–∏–ø–µ–Ω–∏—è –≤–æ–¥—ã, –ü–∞": ps, "–ü–ª–æ—Ç–Ω–æ—Å—Ç—å –≤–æ–¥—ã, –∫–≥/–º3": 1. / props['v'], "–ö–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ø–∞—Å (NPSH), –º": NPSH}
            print_result(data)

        except Exception as e:
            st.error(f"{str(e)}", icon="‚ö†Ô∏è")

with st.expander("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ"):
    st.markdown("[–°—Ç–∞—Ç—å—è](https://dzen.ru/a/X8Nt8mPVdAQVSm6Z) –†–∞—Å—á—ë—Ç –∫–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞")
    st.markdown("[–°—Ç–∞—Ç—å—è](https://dzen.ru/a/YuQlMIkoykP0rEHz) –°–ø–æ—Å–æ–± –±—ã—Å—Ç—Ä–æ–π –æ—Ü–µ–Ω–∫–∏ –∫–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∑–∞–ø–∞—Å–∞ –Ω–∞—Å–æ—Å–∞")
